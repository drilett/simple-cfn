{
	"Description" : "Sample CloudFormation script to install tomcat7 and deploy a war file sent via a parameter.  Defaults only work for US East N. Virginia.",

	"Parameters" : {
		"warURL" : {
			"Default" : "https://s3.amazonaws.com/elasticbeanstalk-samples-us-east-1/elasticbeanstalk-sampleapp.war",
			"Description" : "This is the war file which will be installed on the instance.",
			"Type" : "String"
		},
		"AWSImageID" : {
			"Default" : "ami-1624987f",
			"Type" : "String"

		},
		"EC2InstanceType" : {
			"Default" : "m1.small",
			"Type" : "String"
		},
		"SSHKey" : {
			"Default" : "3770pub",
			"Type" : "String"	
		}
	},

	"Resources" : {
		"TC7Instance" : {
			"Type" : "AWS::EC2::Instance",
			"Properties" : {
				"ImageId" : { "Ref" : "AWSImageID" },
				"KeyName" : { "Ref" : "SSHKey" },
				"SecurityGroups" : [ { "Ref" : "TC7SecurityGroup" } ],
				"InstanceType" : { "Ref" : "EC2InstanceType" },
				"UserData" : { "Fn::Base64" : { "Fn::Join" : ["",[
            		"#!/bin/bash -ex","\n",
            		"yum -y install tomcat7","\n",
            		"cd  /var/lib/tomcat7/webapps","\n",
            		"wget ", { "Ref" : "warURL" },"\n",
            		"WAR=", { "Ref" : "warURL" },"\n",
            		"chown root.tomcat $WAR","\n" ]]}
				}
			}
		},

		"TC7SecurityGroup" : {
	    	"Type" : "AWS::EC2::SecurityGroup",
	      	"Properties" : {
		        "GroupDescription" : "Enable HTTP access via port 8080 and SSH via 22",
		        "SecurityGroupIngress" : [ 
		        	{ "IpProtocol" : "tcp","FromPort" : "8080","ToPort" : "8080","CidrIp" : "0.0.0.0/0"	},
		        	{ "IpProtocol" : "tcp","FromPort" : "22","ToPort" : "22","CidrIp" : "0.0.0.0/0"	}
	        	]
	    	}
    	}
	},

	"Outputs" : {
		"PublicIP" : {
		      "Description" : "Public IP address.",
		      "Value" : { "Fn::GetAtt" : [ "TC7Instance", "PublicIp" ] }
		}
	}
}